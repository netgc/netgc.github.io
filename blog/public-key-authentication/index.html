<!DOCTYPE html>
<html lang="en">

<!-- Head tag (contains Google-Analytics、Baidu-Tongji)-->
<head>
  <!-- Google Analytics -->
  

  <!-- Baidu Tongji -->
  
    <script type="text/javascript">
      // Originial
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?2bb536d3dd0b9939875b1491d84cce9c";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  <!-- Baidu Push -->
  
    <script>
      (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
      })();
    </script>
  

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  
  <meta name="google-site-verification" content="cQdiYmfnUizHR5_mlq5DfwwqcUc7QOET5xiRSYR135k"/>
  
  
  
  <meta name="bytedance-verification-code" content="gxLK9s/GZWOg4uM84+f4"/>
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title> 使用 Public Key 认证（Linux、Cisco、F5、Palo Alto、Fortinet、Juniper） - sysin | 软件与技术分享 | SYStem INside </title>
  <meta name="description" content=" 使用 Public Key 认证（Linux、Cisco、F5、Palo Alto、Fortinet、Juniper） - sysin | 软件与技术分享 | SYStem INside "/>
  <meta name="keyword" content=" 使用 Public Key 认证（Linux、Cisco、F5、Palo Alto、Fortinet、Juniper） "/>
  <link rel="shortcut icon" href="/img/favicon.png"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
  <link rel="manifest" href="/site.webmanifest"/>
  <!-- ga & ba script hoook -->
  <link rel="canonical" href="https://sysin.cn/blog/public-key-authentication/">

  <!-- Place this tag in your head or just before your close body tag. -->
  <!-- <script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script> -->

  
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css"/>

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css"/>
    <link rel="stylesheet" href="/css/widget.css"/>
    <link rel="stylesheet" href="/css/rocket.css"/>
    <link rel="stylesheet" href="/css/signature.css"/>
    <link rel="stylesheet" href="/css/catalog.css"/>
    <link rel="stylesheet" href="/css/livemylife.css"/>

    
      <!-- wave start -->
      <link rel="stylesheet" href="/css/wave.css"/>
      <!-- wave end -->
    

    
      <!-- top start (article top hot config) -->
      <link rel="stylesheet" href="/css/top.css"/>
      <!-- top end -->
    

    
      <!-- reward start -->
      <link rel="stylesheet" href="/css/donate.css"/>
      <!-- reward end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/scroll.css"/>
      <!-- ThemeColor end -->
    

    

    
      <!-- Search start -->
      <link rel="stylesheet" href="/css/search.css"/>
      <!-- Search end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/themecolor.css"/>
      <!-- ThemeColor end -->
    

    
      <!-- waline start -->
      <script type="text/javascript" src="/js/waline.js"></script>
      <!-- <script type="text/javascript" src="https://unpkg.com/@waline/client@v2/dist/waline.js"></script> -->
      <link rel="stylesheet" href="/css/waline.css"/>
      <!-- <link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"/> -->
      <!-- waline end -->
    

    

    

    
  

  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <!-- <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css"> -->
  <!-- GC change CDN to local: css/font-awesome.min.css & fonts/fontawesome-webfont.* 5 file-->
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">
  <!-- ThemeColor Icon -->
  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" type="text/css"/> -->
  <link rel="stylesheet" href="/css/google-icon.css" type="text/css"/>

  <!-- Hux Delete, sad but pending in China <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'> <link
  href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/ css'> -->

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]-->


<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="sysin" type="application/atom+xml">
<link rel="alternate" href="/feed.xml" title="sysin" type="application/rss+xml">
</head>


<!-- hack iOS CSS :active style -->

	<body ontouchstart="" class="body--light body--light">


		<!-- ThemeColor -->
		
		<!-- ThemeColor -->
<style type="text/css">
  .body--light {
    --light-mode: none;
    --dark-mode: block;
  }
  .body--dark {
    --light-mode: block;
    --dark-mode: none;
  }
  i.mdui-icon.material-icons.light-mode {
    display: var(--light-mode);
  }
  i.mdui-icon.material-icons.dark-mode {
    display: var(--dark-mode);
  }
</style>
<div class="toggle" onclick="document.body.classList.toggle('body--dark')">
  <i class="mdui-icon material-icons light-mode"></i>
  <i class="mdui-icon material-icons dark-mode"></i>
</div>
<script>
  //getCookieValue
  function getCookieValue(a) {
    var b = document.cookie.match('(^|[^;]+)\\s*' + a + '\\s*=\\s*([^;]+)');
    return b
      ? b.pop()
      : '';
  }
  let themeMode = 'light';
  if (getCookieValue('sb-color-mode') && (getCookieValue('sb-color-mode') !== themeMode)) {
    let dbody = document.body.classList;
    themeMode === 'dark' ? dbody.remove('body--dark') : dbody.add('body--dark');
  }

  //setCookieValue
  var toggleBtn = document.querySelector(".toggle");
  toggleBtn.addEventListener("click", function () {
    var e = document.body.classList.contains("body--dark");
    var cookieString = e
      ? "dark"
      : "light";
    var exp = new Date();
    exp.setTime(exp.getTime() + 3 * 24 * 60 * 60 * 1000); //3天过期
    document.cookie = "sb-color-mode=" + cookieString + ";expires=" + exp.toGMTString() + ";path=/";
  });
</script>

		

		<!-- Gitter -->
		

		<!-- Navigation (contains search)-->
		<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/" ><img src="/img/logo.png" width="64" alt="sysin" height="64" border="0" style="vertical-align:middle"></a>
      <!-- <a class="navbar-brand" href="/">sysin</a> -->
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux: <nav>'s height woule be hold on by its content. so, when navbar scale out, the <nav> will cover tags. also mask any touch event of tags, unfortunately. -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">首页</a>
          </li>

          
          
          
          
          <li>
            <a href="/about/">
              
              关于
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/archive/">
              
              归档
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/categories/">
              
              分类
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/donate/">
              
              捐助
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/tags/">
              
              标签
              
              
            </a>
          </li>
          
          

          
          <li>
            <a class="popup-trigger">
              <span class="search-icon"></span>搜索</a>
          </li>
          

          <!-- LangSelect -->
          
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- progress -->
<div id="progress">
  <div class="line" style="width: 0%;"></div>
</div>

<script>
  // Drop Bootstarp low-performance Navbar Use customize navbar with high-quality material design animation in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function() {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


		<!-- Post Header (contains intro-header、signature、wordcount、busuanzi、waveoverlay) -->
		<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->

  <style type="text/css">
    .body--light {
      /* intro-header */
      --intro-header-background-image-url-home: url('/img/header_img/home.jpg');
      --intro-header-background-image-url-post: url('/img/article_header/article_header.jpg');
      --intro-header-background-image-url-page: url('//img/article_header/article_header.jpg');
    }
    .body--dark {
      --intro-header-background-image-url-home: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/home.jpg');
      --intro-header-background-image-url-post: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/article_header/article_header.jpg');
      --intro-header-background-image-url-page: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('//img/article_header/article_header.jpg');
    }

    header.intro-header {
       /*post*/
        background-image: var(--intro-header-background-image-url-post);
        /* background-image: url('/img/article_header/article_header.jpg'); */
      
    }

    
  </style>





<header class="intro-header">
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-11 col-lg-offset-0 col-md-10 col-md-offset-1">
          
          <div class="post-heading">
            <div class="tags">
              
              <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
              
              <a class="tag" href="/tags/#Cisco" title="Cisco">Cisco</a>
              
              <a class="tag" href="/tags/#NX-OS" title="NX-OS">NX-OS</a>
              
              <a class="tag" href="/tags/#F5" title="F5">F5</a>
              
              <a class="tag" href="/tags/#FortiOS" title="FortiOS">FortiOS</a>
              
              <a class="tag" href="/tags/#PAN-OS" title="PAN-OS">PAN-OS</a>
              
            </div>
            <h1>使用 Public Key 认证（Linux、Cisco、F5、Palo Alto、Fortinet、Juniper）</h1>
            <h2 class="subheading">本文介绍了 Public Key 认证的一般原理，及其在 Linux、Cisco IOS、Cisco NX-OS、F5 BIG-IP、Palo Alto PAN-OS、Fortinet FortiOS 和 Juniper JUNOS 中的配置方法及建议。</h2>
            <span class="meta">
              Posted by sysin on
              2020-08-21
            </span>


            
            <!-- WordCount start -->
            <div class="blank_box"></div>
            <span class="meta">
              Estimated Reading Time <span class="post-count">23</span> Minutes
            </span>
            <div class="blank_box"></div>
            <span class="meta">
              Words <span class="post-count">5.1k</span> In Total
            </span>
            <div class="blank_box"></div>
            <!-- WordCount end -->
            
            


          </div>
          
        </div>
      </div>
    </div>
  </div>

  
  <!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
  

</header>



		<!-- Main Content (Post contains
	Pager、
	tip、
	socialshare、
	gitalk、gitment、disqus-comment、
	Catalog、
	Sidebar、
	Featured-Tags、
	Friends Blog、
	anchorjs、
	) -->
		<!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div class="col-lg-10 col-lg-offset-0 col-md-10 col-md-offset-1 post-container">

        <!-- pageview_count start -->
        
        <div style="color:gray" align="left">
        更新日期：Fri Aug 21 2020 09:10:00 GMT+0800，阅读量: <span class="waline-pageview-count" />
        <script type="module">
          import { pageviewCount } from '/js/pageview.mjs';
          pageviewCount({
            serverURL: 'https://discuss.sysin.cn',
            path: window.location.pathname,
            // 可选的，用于自定选择器，默认为 `'.waline-pageview-count'`
            // selector: 'waline-pageview-count',
            // 可选的，是否在获取时增加访问量，默认为 `true`
            // update: true,
          });
        </script>
        </div>
        
        <!-- pageview_count end -->

        <!-- toppromotion start -->
        
        <!-- toppromotion end -->

        <p>请访问原文链接：<a href="/blog/public-key-authentication/" title="使用 Public Key 认证（Linux、Cisco、F5、Palo Alto、Fortinet、Juniper）">使用 Public Key 认证（Linux、Cisco、F5、Palo Alto、Fortinet、Juniper）</a> 查看最新版。原创作品，转载请保留出处。</p>
<p>作者主页：<a target="_blank" rel="noopener" href="https://sysin.org">sysin.org</a></p>
<hr>
<p>摘要：本文介绍了 Public Key 认证的一般原理，及其在 Linux、Cisco IOS、Cisco NX-OS、F5 BIG-IP、Palo Alto PAN-OS、Fortinet FortiOS 和 Juniper JUNOS 中的配置方法及建议。</p>
<hr>
<h2 id="一、Public-Key-认证基本原理">一、Public Key 认证基本原理</h2>
<p>Public Key（非对称，asymmetric）认证使用一对相关联的 Key Pair（一个公钥 Public Key，一个私钥 Private Key）来代替传统的密码（或我们常说的口令，Password）。顾名思义，Public Key 是用来公开的，可以将其放到 SSH 服务器自己的帐号中，而 Private Key 只能由自己保管，用来证明自己身份。</p>
<p>使用 Public Key 加密过的数据只有用与之相对应的 Private Key 才能解密。这样在认证的过程中，Public Key 拥有者便可以通过Public Key 加密一些东西发送给对应的 Private Key 拥有者，如果在通信的双方都拥有对方的 Public Key（自己的 Private Key 只由自己保管），那么就可以通过这对 Key Pair 来安全地交换信息，从而实现相互认证。在使用中，我们把自己的 Public Key 放在通过安全渠道放到服务器上，Private Key 自己保管（用一个口令把 Private Key 加密后存放），而服务器的 Public Ke y一般会在第一次登录服务器的时候存放到本地客户端（严格地说来服务器的 Public Key 也应该通过安全渠道放到本地客户端，以防止别人用他自己的 Public Key 来欺骗登录）。</p>
<h2 id="二、Public-Key-认证相对于-Password-认证的优点">二、Public Key 认证相对于 Password 认证的优点</h2>
<p>常用的 SSH 认证方式有：</p>
<p>a. 基于主机 IP（rhost）的认证：对于某个主机（IP）信任并让之登录，这种认证容易受到 IP 欺骗攻击。<br>
b. Kerberos 认证：一个大型的基于域的认证，这种认证安全性高，但是太大、太复杂不方便部署。<br>
c. PAM 认证：类似于传统的密码认证，是绝大多数 Unix/Linux 系统自带的一个认证和记帐的模块，它的功能比较复杂，配置起来比较麻烦。而且，容易由于配置失误而引起安全问题。<br>
d. 传统的 Unix/Linux 口令（或密码 Password）认证：在客户端直接输入帐号密码，然后让 SSH 加密传输到服务器端验证。</p>
<p>在众多 SSH 登录认证中，传统的单口令（Password）认证用得比较多，所以在这里我们主要对比一下 SSH 认证中的口令（Password）认证和 Public Key 认证的区别。这种认证方式有着如下明显的缺点：</p>
<p>1）为了确保密码安全，密码必须很长很复杂，但是这样的密码很难记忆；<br>
2）对于自己所拥有的每个帐号，为了安全，不同的帐号都要设置不同的密码，管理起来很不方便；<br>
3）对于默认帐号，默认密码，例如装机时用的帐号，如果一时疏忽没有改密码，被其它不怀好意的人扫描到帐号和密码，可能会造成安全漏洞；<br>
4）如果远程主机已经被攻击，即使使用 SSH 安全通道进行保护，在网络上发送的密码在到达远程主机时也可能被截获；<br>
5）对于每个帐号的修改都要人工登录（为了安全，不能把 Password 放到脚本里），随着服务器数量增多，这项工作会变得十分烦琐。</p>
<p>相反，使用 Public Key 认证正好可以解决上述问题，即其优势所在。</p>
<h2 id="三、Linux-Public-Key-配置">三、Linux Public Key 配置</h2>
<p>使用一种被称为 “公私钥” 认证的方式来进行 ssh 登录. “公私钥” 认证方式简单的解释：首先在客户端上创建一对公私钥 （公钥文件：~/.ssh/id_rsa.pub； 私钥文件：~/.ssh/id_rsa）</p>
<p>然后把公钥放到服务器上（~/.ssh/authorized_keys）, 自己保留好私钥。在使用 ssh 登录时，ssh 程序会发送私钥去和服务器上的公钥做匹配。如果匹配成功就可以登录了。</p>
<p>步骤如下：先要在本地生成一个 rsa 的公共 key，然后 copy 到远程你要认证的服务器创建 key</p>
<p>（1）本地</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">SYSIN-SRV# </span><span class="language-bash">ssh-keygen -t rsa  <span class="comment">#可选参数 -b 2048，CentOS7 中默认</span></span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa)：</span><br><span class="line">Created directory &#x27;/root/.ssh&#x27;.</span><br><span class="line">Enter passphrase (empty for no passphrase)：</span><br><span class="line">Enter same passphrase again：</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is：</span><br><span class="line">SHA256：MfZHl/b8XhGTU59fhLHptmzNFnhCrorySvGojyb69dM root@SYSIN-SRV  #root@SYSIN-SRV 这里是当前用户名@主机名，公钥文件中可以删除</span><br><span class="line">The key&#x27;s randomart image is：</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|+= = . . ....    |</span><br><span class="line">|O.E +   o    .   |</span><br><span class="line">|*+     o    . .  |</span><br><span class="line">|+o. . . o. . .   |</span><br><span class="line">|+  o o .SBo .    |</span><br><span class="line">|  . + oo++=+     |</span><br><span class="line">|   o +. o.+.     |</span><br><span class="line">|  . o..  o  .    |</span><br><span class="line">|   . ...  ..     |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>
<p>直接三次回车即可，这里会提示输入密码 passphrase，这个密码与与远程 ssh 登录密码无关。Public-key 证机制比密码要安全，因为密码不在网络上传输，而且可以是用加密的方式存储的。为了安全，也可以设置一个 passphrase，这样，别人拿到密钥也没有用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> .ssh/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">id_rsa  id_rsa.pub  known_hosts</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> id_ras.pub authorized_keys //本机公钥配置，允许 ssh localhost 免密登录</span></span><br><span class="line">//id_rsa 文件复制到其他机器上复用，权限需要设置为600</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">chmod</span> 600 id_rsa</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ssh 对目录的权限有要求，建议设置如下</span></span><br><span class="line">chmod 700 ~/.ssh</span><br><span class="line">chmod -R 600 ~/.ssh/*</span><br></pre></td></tr></table></figure>
<p><strong>Correct file permissions on <code>~/.ssh</code> folder and its content:</strong></p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Permission</th>
</tr>
</thead>
<tbody>
<tr>
<td>.ssh directory</td>
<td>700 ((drwx------)</td>
</tr>
<tr>
<td>public keys: id_rsa_pub (=authorized_keys)</td>
<td>644 (-rw-r–r–)</td>
</tr>
<tr>
<td>private keys: id_rsa</td>
<td>600 (-rw-------)</td>
</tr>
<tr>
<td>authorized_keys</td>
<td>600 (-rw-------)</td>
</tr>
<tr>
<td>known_hosts</td>
<td>600 (-rw-------)</td>
</tr>
<tr>
<td>config</td>
<td>600 (-rw-------)</td>
</tr>
</tbody>
</table>
<p>（2）将公钥文件复制到远程服务器上：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># ssh-copy-id root@目标节点IP</span></span><br></pre></td></tr></table></figure>
<p>这里 root 是在目标节点上登录的用户，@ 符号后面接目标节点 IP 即可，之后会提示输入目标节点 root 用户密码，输入即可。</p>
<p>添加认证信息后，目标节点主机的 ~/.ssh/ 目录下将会出现一个 authorized_keys 文件，里面包含了管理节点的公钥信息，可以检查一下是否存在。</p>
<p>保存好上述生成的公钥和私钥文件后，可以上传到其他主机（或者网络设备）上直接使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 直接上传已有的 Public key</span></span></span><br><span class="line">mkdir ~/.ssh</span><br><span class="line">cd ~/.ssh</span><br><span class="line">上传 id_rsa 和 id_rsa.pub 到当前目录</span><br><span class="line">mv id_rsa.pub authorized_keys</span><br><span class="line">chmod 700 ~/.ssh</span><br><span class="line">chmod -R 600 ~/.ssh/*</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 测试访问是否正常</span></span></span><br><span class="line">ssh localhost</span><br></pre></td></tr></table></figure>
<p>（3）修改 sshd 配置文件：</p>
<p>启用 Public key 认证并关闭传统密码认证，重启 sshd 服务生效。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># CentOS 7 默认配置如下</span></span></span><br><span class="line">PasswordAuthentication yes</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 取消注释#PubkeyAuthentication yes</span></span></span><br><span class="line">sed -i &#x27;s/^#\(PubkeyAuthentication yes\)/\1/&#x27; /etc/ssh/sshd_config</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 修改为PasswordAuthentication no，即替换行</span></span></span><br><span class="line">sed -i &#x27;/^PasswordAuthentication yes/c PasswordAuthentication no&#x27; /etc/ssh/sshd_config</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 写入文件需要添加 -i 参数</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 重启sshd服务 (sysin)</span></span></span><br><span class="line">service sshd restart</span><br></pre></td></tr></table></figure>
<h2 id="四、SSH-客户端设置">四、SSH 客户端设置</h2>
<h3 id="1-使用-Putty-客户端">1. 使用 Putty 客户端</h3>
<p>如果使用 Windows 中的 Putty</p>
<p>如果想使用 putty，因为 ssh-keygen 生成的 SSH2 和 putty 的 key 格式不同，无法直接使用，必须用 puttygen.exe 转换一下：</p>
<p>把 Linux 的 id_rsa copy 到 windows 中，运行 puttygen.exe，选择菜单 Conversions -&gt; Import key 然后 save private key，就可以使用这个 private key 设置 putty 了。</p>
<p>Windows 中设置 Putty 使用 key</p>
<p>1） 启动 Putty，设置好 session 的各项参数（如果以前已经设置过，那么 load 一下），然后从左边选择“SSH-&gt;Auth”，点击 Browse 按钮，选择 key.ppk 文件。<br>
2） 设置 auto-login 用户名，Connection -&gt; Data -&gt; Auto-login username<br>
3） 再从左边选择 Session，然后点击 Save 按钮把修改保存下来。然后点击 Open 按钮就可以登录了。</p>
<p>如果上面的操作都没有问题，那这时应该就自动登录了，无需输入密码。</p>
<p>putty 的密钥转换成 SecureCRT 的密钥</p>
<p>以前用的是 putty，生成了 PUB/PRIVATE KEY的，现在用 puttygen.exe load private key，然后用 Conversions 导出到 openssh 格式的 private key，名为 identy，接着把 pubkey 也导出来，叫 identy.pub，放到相同的目录下，最后在 securecrt 的 session 里指定 private key 就 OK 了，一定要弄成 xx xx.pub 的形式，否则会说找不到密码。</p>
<h3 id="2-使用-SecureCRT-配置公钥">2. 使用 SecureCRT 配置公钥</h3>
<p>在 Windows 客户机上，建立 C:/SSH 目录，然后将 id_dsa 和 id_dsa.pub 原封不动的复制到 C:/SSH 里，确保文件名为 id_dsa 和 id_dsa.pub（macOS类似）</p>
<p>第一步，按向导正常连接一台主机 SSH，填写主机名和用户名<br>
第二步，编辑会话主机的属性，Connection–SSH2，右侧 Authentication 页面选中 PublicKey，点击 “Properties…”<br>
第三步，默认选中 Use global public key ，Use identity or certificate file 那里，点击“…”按钮，浏览我的电脑，找到 C:/SSH 目录，选中 id_dsa 文件，然后确定。</p>
<p>保存好配置，关闭 SecureCRT，然后打开配置了证书的主机，正常情况下将提示要输入密钥的加密字，输入后就应该可以登录进系统了。<br>
同时再打开另一个 SecureCRT 窗口。登录同样的主机，由于 SecureCRT 已缓存了证书及加密字，因此不再需要输入用户名密码，使用就很方便了！</p>
<h2 id="五、Cisco-IOS、IOS-XE">五、Cisco IOS、IOS-XE</h2>
<h3 id="1-启用-public-key-认证">1. 启用 public key 认证</h3>
<h4 id="在-Linux-上生成-key">在 Linux 上生成 key</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">SYSIN-SRV# </span><span class="language-bash">ssh-keygen -t rsa  <span class="comment">#可选参数 -b 2048，CentOS7 中默认</span></span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa)：</span><br><span class="line">Created directory &#x27;/root/.ssh&#x27;.</span><br><span class="line">Enter passphrase (empty for no passphrase)：</span><br><span class="line">Enter same passphrase again：</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is：</span><br><span class="line">SHA256：MfZHl/b8XhGTU59fhLHptmzNFnhCrorySvGojyb69dM root@SYSIN-SRV  #root@SYSIN-SRV 这里是当前用户名@主机名，公钥文件中可以删除</span><br><span class="line">The key&#x27;s randomart image is：</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|+= = . . ....    |</span><br><span class="line">|O.E +   o    .   |</span><br><span class="line">|*+     o    . .  |</span><br><span class="line">|+o. . . o. . .   |</span><br><span class="line">|+  o o .SBo .    |</span><br><span class="line">|  . + oo++=+     |</span><br><span class="line">|   o +. o.+.     |</span><br><span class="line">|  . o..  o  .    |</span><br><span class="line">|   . ...  ..     |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>
<h4 id="在-Linux-主机上查看-public-key">在 Linux 主机上查看 public key</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 默认是一行</span></span></span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDefQcDto4gCHqf0umUCAY1O7GHPwU+Se92aUHVkVI4Kd8sJVFoQKjvMga9dRm12zGDDO/wM9tSHWKc+msARsz2m6h1HbsiR7CoOTPtTuDc/BN3m7Q7SGXzf51AI3tvOQ4IhlDwRMFBLGTFVVDjpYMDZjwZNEwCBbeZMETNUedCvbyduEmOaZIm5LzCQ5upPG+uEMsP5Sh8XQX5vK8P5P04EmCAEqned5FmHMrPI3kGfabxRhiLa7Ujv3gMh4z59tKmVsoMyKXU3gf+561D9BdvuTo+gvtUElghBvz3wiPA45KW7LL2INBXiJ89p0iOmkiAEnxkDdsXpq+GEj2PaiE9</span><br></pre></td></tr></table></figure>
<h4 id="转换成多行格式">转换成多行格式</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Cisco does not accept the entire key pasted into one long line, so you need to break it into multiple lines. The maximum line length at the Cisco CLI is 254 characters, but it&#x27;s convenient to wrap smaller than this so that it fits on a terminal line.</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">fold</span> -b -w 72 ~/.ssh/id_rsa.pub</span></span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDefQcDto4gCHqf0umUCAY1O7GHPwU+Se92</span><br><span class="line">aUHVkVI4Kd8sJVFoQKjvMga9dRm12zGDDO/wM9tSHWKc+msARsz2m6h1HbsiR7CoOTPtTuDc</span><br><span class="line">/BN3m7Q7SGXzf51AI3tvOQ4IhlDwRMFBLGTFVVDjpYMDZjwZNEwCBbeZMETNUedCvbyduEmO</span><br><span class="line">aZIm5LzCQ5upPG+uEMsP5Sh8XQX5vK8P5P04EmCAEqned5FmHMrPI3kGfabxRhiLa7Ujv3gM</span><br><span class="line">h4z59tKmVsoMyKXU3gf+561D9BdvuTo+gvtUElghBvz3wiPA45KW7LL2INBXiJ89p0iOmkiA</span><br><span class="line">EnxkDdsXpq+GEj2PaiE9</span><br></pre></td></tr></table></figure>
<h4 id="在-Cisco-IOS-上配置">在 Cisco IOS 上配置</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">conf t</span><br><span class="line">username admin privilege <span class="number">15</span> <span class="comment">//创建一个没有密码的账号admin</span></span><br><span class="line">ip ssh pubkey-chain</span><br><span class="line">username admin</span><br><span class="line">key-<span class="built_in">string</span></span><br><span class="line">&lt;&lt; paste your multi-line public key here &gt;&gt;</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h4 id="验证-3">验证</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show run | beg pubkey</span><br></pre></td></tr></table></figure>
<h3 id="2-其他配置">2. 其他配置</h3>
<h4 id="Security-settings">Security settings</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 禁用SSH v1</span></span></span><br><span class="line">ip ssh version 2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 禁用telnet</span></span></span><br><span class="line">line vty 0 15</span><br><span class="line"> transport input ssh</span><br></pre></td></tr></table></figure>
<h4 id="Multiple-keys">Multiple keys</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># It is possible to have multiple public keys against the same user in the configuration, so that multiple people can login using the same account. Just add further keys as shown above. When you show the configuration, it will look like this：</span></span></span><br><span class="line"></span><br><span class="line">ip ssh pubkey-chain</span><br><span class="line">  username nsrc</span><br><span class="line">   key-hash ssh-rsa EFF40492D1D6BF5D0B68491128456D27 yourname@yourdomain.example</span><br><span class="line">   key-hash ssh-rsa 768CD77578B0C1B55BCC0C3549D3E573 another@yourdomain.example</span><br></pre></td></tr></table></figure>
<h4 id="移除密码">移除密码</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># You can remove passwords from users in the configuration; this will force those users to use ssh key authentication. If these people require admin rights they will either still need to know the enable secret, or their login can drop them directly into enable mode：</span></span></span><br><span class="line">username foo privilege 15</span><br><span class="line">示例：</span><br><span class="line">no username admin</span><br><span class="line">username admin privilege 15</span><br></pre></td></tr></table></figure>
<h4 id="Disable-passwords-entirely">Disable passwords entirely</h4>
<p><strong>全局设定，无法通过密码远程访问!!!</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># If you wish to disable password authentication entirely over ssh, but leave passwords on user accounts for other purposes (e.g. console access), then use：</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 禁用SSH的密码认证，但是保留用户密码用于console登录</span></span></span><br><span class="line">no ip ssh server authenticate user password</span><br><span class="line">no ip ssh server authenticate user keyboard</span><br></pre></td></tr></table></figure>
<p>安全建议：<br>
有公网 IP 访问建议启用，特别是设定的用户名比较敏感比如 root、admin 等，取消密码，直接使用 public key 认证</p>
<h2 id="六、Cisco-NX-OS">六、Cisco NX-OS</h2>
<h3 id="1-生成公钥文件id-rsa-pub（参看Linux）">1. 生成公钥文件id_rsa.pub（参看Linux）</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">SYSIN-SRV# </span><span class="language-bash">ssh-keygen -t rsa  <span class="comment">#可选参数 -b 2048，CentOS7 中默认</span></span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa)：</span><br><span class="line">Created directory &#x27;/root/.ssh&#x27;.</span><br><span class="line">Enter passphrase (empty for no passphrase)：</span><br><span class="line">Enter same passphrase again：</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is：</span><br><span class="line">SHA256：MfZHl/b8XhGTU59fhLHptmzNFnhCrorySvGojyb69dM root@SYSIN-SRV  #root@SYSIN-SRV 这里是当前用户名@主机名，公钥文件中可以删除</span><br><span class="line">The key&#x27;s randomart image is：</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|+= = . . ....    |</span><br><span class="line">|O.E +   o    .   |</span><br><span class="line">|*+     o    . .  |</span><br><span class="line">|+o. . . o. . .   |</span><br><span class="line">|+  o o .SBo .    |</span><br><span class="line">|  . + oo++=+     |</span><br><span class="line">|   o +. o.+.     |</span><br><span class="line">|  . o..  o  .    |</span><br><span class="line">|   . ...  ..     |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>
<h3 id="2-配置用户使用密钥">2. 配置用户使用密钥</h3>
<h4 id="2-1-传输-id-rsa-pub-文件到交换机的-bootflash-中并配置用户">2.1. 传输 id_rsa.pub 文件到交换机的 bootflash 中并配置用户</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">N9K#</span><span class="language-bash">copy sftp: bootflash</span></span><br></pre></td></tr></table></figure>
<p>示例使用的用户名为 sysin</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">N9K#</span><span class="language-bash"><span class="comment">#conf</span></span></span><br><span class="line"><span class="meta prompt_">N9K(config)#</span><span class="language-bash">username sysin role network-admin  //创建一个没有密码的用户</span></span><br><span class="line"><span class="meta prompt_">N9K(config)#</span><span class="language-bash">username sysin sshkey file bootflash：id_rsa.pub</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-直接复制密钥进行配置">2.2. 直接复制密钥进行配置</h4>
<p>第二种方式：直接复制 id_rsa.pub 中的 key 输入如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">N9K#</span><span class="language-bash"><span class="comment">#conf</span></span></span><br><span class="line"><span class="meta prompt_">N9K(config)#</span><span class="language-bash">username sysin role network-admin  //创建一个没有密码的用户</span></span><br><span class="line"><span class="meta prompt_">N9K(config)#</span><span class="language-bash">username sysin sshkey ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDefQcDto4gCHqf0umUCAY1O7GHPwU+Se92aUHVkVI4Kd8sJVFoQKjvMga9dRm12zGDDO/wM9tSHWKc+msARsz2m6h1HbsiR7CoOTPtTuDc/BN3m7Q7SGXzf51AI3tvOQ4IhlDwRMFBLGTFVVDjpYMDZjwZNEwCBbeZMETNUedCvbyduEmOaZIm5LzCQ5upPG+uEMsP5Sh8XQX5vK8P5P04EmCAEqned5FmHMrPI3kGfabxRhiLa7Ujv3gMh4z59tKmVsoMyKXU3gf+561D9BdvuTo+gvtUElghBvz3wiPA45KW7LL2INBXiJ89p0iOmkiAEnxkDdsXpq+GEj2PaiE9</span></span><br></pre></td></tr></table></figure>
<h3 id="3-验证配置">3. 验证配置</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">N9K# </span><span class="language-bash">show user-account sysin</span></span><br><span class="line">user：sysin</span><br><span class="line">        this user account has no expiry date</span><br><span class="line">        roles：network-admin</span><br><span class="line">no password set. Local login not allowed  //没有设置密码只能远程登录</span><br><span class="line">Remote login through RADIUS/TACACS+ is possible</span><br><span class="line">        ssh public key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDefQcDto4gCHqf0umUCAY1O7GHPw</span><br><span class="line">        U+Se92aUHVkVI4Kd8sJVFoQKjvMga9dRm12zGDDO/wM9tSHWKc+msARsz2m6h1HbsiR7CoOTPtTuDc/BN3</span><br><span class="line">        m7Q7SGXzf51AI3tvOQ4IhlDwRMFBLGTFVVDjpYMDZjwZNEwCBbeZMETNUedCvbyduEmOaZIm5LzCQ5upPG+uEMsP5Sh8XQX5vK8P5P04EmCAEqned5FmHMrPI3kGfabxRhiLa7Ujv3gMh4z59tKmVsoMyKXU3gf+561D</span><br><span class="line">        9BdvuTo+gvtUElghBvz3wiPA45KW7LL2INBXiJ89p0iOmkiAEnxkDdsXpq+GEj2PaiE9</span><br></pre></td></tr></table></figure>
<h3 id="4-验证-2">4. 验证</h3>
<p>使用 Linux 主机 SSH 登录到交换机上并执行命令，没有任何密码提示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">SYSIN-SRV# </span><span class="language-bash">ssh sysin@10.66.78.53 <span class="string">&quot;sh system uptime&quot;</span></span></span><br><span class="line">Warning: the output may not have all the roles</span><br><span class="line">System start time: Tue May 29 17：51：30 2012</span><br><span class="line">System uptime: 7 days, 19 hours, 42 minutes, 15 seconds</span><br><span class="line">Kernel uptime: 7 days, 19 hours, 45 minutes, 17 seconds</span><br></pre></td></tr></table></figure>
<h2 id="七、F5-BIG-IP">七、F5 BIG-IP</h2>
<h3 id="1-标准做法">1. 标准做法</h3>
<p>使用 publc key 认证，参看官方文档：<a target="_blank" rel="noopener" href="https://support.f5.com/csp/article/K13454">K13454</a></p>
<p>F5 基于 CentOS 构建，与 Linux 操作方式类似。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 直接上传已有的Public key</span></span></span><br><span class="line">cd /root</span><br><span class="line">mkdir .ssh</span><br><span class="line">cd .ssh</span><br><span class="line">上传 id_rsa.pub 到 .ssh 目录下</span><br><span class="line">cp id_rsa.pub authorized_keys</span><br></pre></td></tr></table></figure>
<p>如果是要两台之间免密登录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">上传 id_rsa 到 .ssh 目录下</span><br><span class="line">chmod 700 id_rsa</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 测试访问是否正常</span></span></span><br><span class="line">ssh localhost</span><br></pre></td></tr></table></figure>
<p>默认 PubkeyAuthentication 是开启的，不需要像 Linux 那样修改 sshd 配置文件（/config/ssh/sshd_config）。</p>
<p>注意：</p>
<ol>
<li>禁用密码登录，似乎不支持</li>
<li>限制源地址访问sshd：全局限制，不能针对用户个别设置</li>
</ol>
<p>安全建议：</p>
<ol>
<li>建议设定 sshd 和 httpd 限制源地址访问</li>
<li>禁用默认 admin 和 root 账号</li>
<li>创建替代的管理员帐号</li>
</ol>
<h3 id="2-建议做法">2. 建议做法</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -m 755 -p /var/ssh/&lt;username&gt;</span><br><span class="line">mv /home/&lt;username&gt;/.ssh/authorized_keys /var/ssh/&lt;username&gt;</span><br><span class="line">cd /home/&lt;username&gt;/.ssh &amp;&amp; ln -s /var/ssh/&lt;username&gt;/authorized_keys</span><br></pre></td></tr></table></figure>
<p>参看系统默认 root 账号配置</p>
<p>当前支持版本：v11.6.5，v12.1.5，v13.1.0，v14.1.0，v15.1.0，v16.0.0 及以上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost：Active：Standalone] config # cd /root/.ssh</span><br><span class="line">[root@localhost：Active：Standalone] config # alias ll=&#x27;ls -lahF --color&#x27;</span><br><span class="line">[root@localhost：Active：Standalone] .ssh # ll</span><br><span class="line">total 10K</span><br><span class="line">drwxr-xr-x. 2 root root 1.0K Jun 23 20：13 ./</span><br><span class="line">dr-x------. 3 root root 1.0K Jul 14 21：42 ../</span><br><span class="line">lrwxrwxrwx. 1 root root   29 Jun 23 20：13 authorized_keys -&gt; /var/ssh/root/authorized_keys</span><br><span class="line">lrwxrwxrwx. 1 root root   22 Jun 23 20：13 identity -&gt; /var/ssh/root/identity</span><br><span class="line">lrwxrwxrwx. 1 root root   26 Jun 23 20：13 identity.pub -&gt; /var/ssh/root/identity.pub</span><br><span class="line">lrwxrwxrwx. 1 root root   25 Jun 23 20：13 known_hosts -&gt; /var/ssh/root/known_hosts</span><br><span class="line">-rw-r--r--. 1 root root  262 Jun 23 16：27 README</span><br><span class="line">[root@localhost：Active：Standalone] .ssh # cat README</span><br><span class="line">WARNING!!</span><br><span class="line"></span><br><span class="line">Do not manually change the files in this directory!</span><br><span class="line">The ssh keys in this directory are generated at first boot and are unique</span><br><span class="line">to your machine.</span><br><span class="line">These keys are needed for communication with the SCCP.</span><br><span class="line"></span><br><span class="line">To generate new keys, please run `keyswap.sh sccp`.</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost：Active：Standalone] config # find / -name authorized_keys</span><br><span class="line">/shared/ssh/root/authorized_keys</span><br><span class="line">/root/.ssh/authorized_keys</span><br><span class="line">find: &#x27;/proc/13236&#x27;: No such file or directory</span><br><span class="line">find: &#x27;/proc/13267&#x27;: No such file or directory</span><br><span class="line">find: &#x27;/opt/.sdm/proc/13324&#x27;: No such file or directory</span><br><span class="line"></span><br><span class="line">[root@localhost：Active：Standalone] config # ll /shared/ssh/root/authorized_keys</span><br><span class="line">-rw-r--r--. 1 root root 406 Jul 14 20：06 /shared/ssh/root/authorized_keys</span><br><span class="line">[root@localhost：Active：Standalone] config # cat /shared/ssh/root/authorized_keys</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCKV2v1jzTATRIbyat3g6WruNQSWDcdKNafhG66rNyAJ09guCukkjbRwARJGzZWKxdhSqqHvMW32fZYAX6ZCl/9eDoGjh08eKELJVxn6q7UI3xAM/ze+4GUrSStlEdagBsB/sNGvp0gr1b0eaALFpE2VsLxVr1wVpcPMKbPr7HHPfQsALakI3El5zayi6U7Ei1W7dU3hs8WoIlj89eMiuFCUXyZDtBaXht0C2nWk8C6SPJjpVfPNh++dttzW2GOfSLvwEKoCHmYGKe/aolYYvdRVGXSOpqDzZsNWBHHSyU92RqMCm1VLM1mg/ew4KFzYocdlpDssh2IaZTbua7Af+P7 Host Processor Superuser</span><br><span class="line"></span><br><span class="line">[root@localhost：Active：Standalone] config # ll /root/.ssh/authorized_keys</span><br><span class="line">lrwxrwxrwx. 1 root root 29 Jun 23 20：13 /root/.ssh/authorized_keys -&gt; /var/ssh/root/authorized_keys</span><br><span class="line">[root@localhost：Active：Standalone] config # cat /root/.ssh/authorized_keys</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCKV2v1jzTATRIbyat3g6WruNQSWDcdKNafhG66rNyAJ09guCukkjbRwARJGzZWKxdhSqqHvMW32fZYAX6ZCl/9eDoGjh08eKELJVxn6q7UI3xAM/ze+4GUrSStlEdagBsB/sNGvp0gr1b0eaALFpE2VsLxVr1wVpcPMKbPr7HHPfQsALakI3El5zayi6U7Ei1W7dU3hs8WoIlj89eMiuFCUXyZDtBaXht0C2nWk8C6SPJjpVfPNh++dttzW2GOfSLvwEKoCHmYGKe/aolYYvdRVGXSOpqDzZsNWBHHSyU92RqMCm1VLM1mg/ew4KFzYocdlpDssh2IaZTbua7Af+P7 Host Processor Superuser</span><br></pre></td></tr></table></figure>
<h2 id="八、Palo-Alto-PAN-OS">八、Palo Alto PAN-OS</h2>
<h3 id="1-生成-ssh-key，参照-Linux">1. 生成 ssh key，参照 Linux</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">SYSIN-SRV# </span><span class="language-bash">ssh-keygen -t rsa  <span class="comment">#可选参数 -b 2048，CentOS7 中默认</span></span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa)：</span><br><span class="line">Created directory &#x27;/root/.ssh&#x27;.</span><br><span class="line">Enter passphrase (empty for no passphrase)：</span><br><span class="line">Enter same passphrase again：</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is：</span><br><span class="line">SHA256：MfZHl/b8XhGTU59fhLHptmzNFnhCrorySvGojyb69dM root@SYSIN-SRV  #root@SYSIN-SRV 这里是当前用户名@主机名，公钥文件中可以删除</span><br><span class="line">The key&#x27;s randomart image is：</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|+= = . . ....    |</span><br><span class="line">|O.E +   o    .   |</span><br><span class="line">|*+     o    . .  |</span><br><span class="line">|+o. . . o. . .   |</span><br><span class="line">|+  o o .SBo .    |</span><br><span class="line">|  . + oo++=+     |</span><br><span class="line">|   o +. o.+.     |</span><br><span class="line">|  . o..  o  .    |</span><br><span class="line">|   . ...  ..     |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>
<h3 id="2-配置-Public-Key-认证">2. 配置 Public Key 认证</h3>
<h4 id="2-1-使用-GUI-界面">2.1 使用 GUI 界面</h4>
<p>参看<a target="_blank" rel="noopener" href="https://www.paloaltonetworks.com/documentation/71/pan-os/pan-os/firewall-administration/configure-ssh-key-based-administrator-authentication-to-the-cli">官方文档</a></p>
<p>创建或者编辑一个帐号</p>
<p>Device - Administrators，点击 Add</p>
<p>勾选 Use Public Key Authentication (SSH)，点击 Import Key，浏览到 id_rsa.pub</p>
<p>可以看到导入后的 key 内容有所变化，被<a target="_blank" rel="noopener" href="https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClJLCA0">自动转换为Base64编码格式</a>，在使用命令行输入时也需要 Base64 编码格式，否则会报错。</p>
<p>勾选 Use only client certificate authentication (Web)，则不需要为账号创建密码（编辑原有用户勾选此选项，原用户密码继续有效）。</p>
<p>此时该用户无法使用 SSH 密码登录，因为没有密码，Web 界面也将无法登录。</p>
<h4 id="2-2-使用-CLI">2.2 使用 CLI</h4>
<p>创建一个同时使用密码和 key 认证的用户账号 sa1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set mgt-config users sa1 password</span><br><span class="line">Enter password   ：</span><br><span class="line">Confirm password ：</span><br><span class="line">set mgt-config users sa1 permissions role-based superuser yes</span><br><span class="line">set mgt-config users sa1 public-key c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFDbjRLMy9Ld1VNZkdJVm4xbDYxNTZOTDR2WHl0T3FORHJUZ2FWb05lcEZuL2tuaE9FOGR4YW1pWWNNK0xJMVU5aksvOVdjeTd0Q2tCeUR3YWs5RjBnS1NVUUlURWpJZTkzNytNQ1NxQU4xR1MxTlNsa2IvcmZjUEs1dGIyam9TejFyb3cyTXl6WDZLVGZDVkc0eVN6UWFTeDRnZmg0d0ZJb3poejdyVFB3YlQ0cjRtejVCaEdKRklBRzAyeUNMdVZNbkhVN0VPdVFmaDI5WTN1cjhOcWdJdnY2UXRTUHN0a0N5dzdrOXNaWmMyZitVVmtTK0FOZVN0dnpXR2JuZ0V0OFlaQjRlRTN1RzRwVWJxbEFXenJjbXVXVmZZRXR6Wkh6VVVtSFlPb1poRVdXbzQ4OER1VXF1NUEvZVJkK1RaZE42WUdMZkliT3dxcG9GVFJyNXc0VEggcm9vdEBTU0xYMTIxCg==</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 注意 public-key 使用Base64编码格式，可以通过Web界面转换</span></span></span><br></pre></td></tr></table></figure>
<p>创建一个仅仅使用 key 认证的用户账号 sa2（该用户无法登录 GUI）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set mgt-config users sa2 permissions role-based superuser yes</span><br><span class="line">set mgt-config users sa2 client-certificate-only yes</span><br><span class="line">set mgt-config users sa2 public-key c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFDbjRLMy9Ld1VNZkdJVm4xbDYxNTZOTDR2WHl0T3FORHJUZ2FWb05lcEZuL2tuaE9FOGR4YW1pWWNNK0xJMVU5aksvOVdjeTd0Q2tCeUR3YWs5RjBnS1NVUUlURWpJZTkzNytNQ1NxQU4xR1MxTlNsa2IvcmZjUEs1dGIyam9TejFyb3cyTXl6WDZLVGZDVkc0eVN6UWFTeDRnZmg0d0ZJb3poejdyVFB3YlQ0cjRtejVCaEdKRklBRzAyeUNMdVZNbkhVN0VPdVFmaDI5WTN1cjhOcWdJdnY2UXRTUHN0a0N5dzdrOXNaWmMyZitVVmtTK0FOZVN0dnpXR2JuZ0V0OFlaQjRlRTN1RzRwVWJxbEFXenJjbXVXVmZZRXR6Wkh6VVVtSFlPb1poRVdXbzQ4OER1VXF1NUEvZVJkK1RaZE42WUdMZkliT3dxcG9GVFJyNXc0VEggcm9vdEBTU0xYMTIxCg==</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 注意 public-key 使用Base64编码格式，可以通过Web界面转换</span></span></span><br></pre></td></tr></table></figure>
<h2 id="九、Fortinet-FortiOS">九、Fortinet FortiOS</h2>
<blockquote>
<p>以下在 FortiOS 6.0 下测试通过</p>
</blockquote>
<ul>
<li>生成密钥</li>
</ul>
<p>一般使用 RSA 2048-bit key，参考 Linux 生成方式</p>
<ul>
<li>语法</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  config system admin</span><br><span class="line">    edit admin</span><br><span class="line">      set ssh-public-key1 &quot;&lt;key-type&gt; &lt;key-value&gt;&quot;</span><br><span class="line">    next</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<ul>
<li>示例</li>
</ul>
<blockquote>
<p>注意格式：不要用开头和结尾的 ---- BEGIN SSH2 PUBLIC KEY ---- 或者注释&quot;[2048-bit dsa,…]&quot; 或者 ---- END SSH2 PUBLIC KEY ---- 等内容<br>
示例，同时删除已经设置的密码，新账号不用设置密码：</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  config system admin</span><br><span class="line">    edit admin</span><br><span class="line">      set ssh-public-key1 &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDefQcDto4gCHqf0umUCAY1O7GHPwU+Se92aUHVkVI4Kd8sJVFoQKjvMga9dRm12zGDDO/wM9tSHWKc+msARsz2m6h1HbsiR7CoOTPtTuDc/BN3m7Q7SGXzf51AI3tvOQ4IhlDwRMFBLGTFVVDjpYMDZjwZNEwCBbeZMETNUedCvbyduEmOaZIm5LzCQ5upPG+uEMsP5Sh8XQX5vK8P5P04EmCAEqned5FmHMrPI3kGfabxRhiLa7Ujv3gMh4z59tKmVsoMyKXU3gf+561D9BdvuTo+gvtUElghBvz3wiPA45KW7LL2INBXiJ89p0iOmkiAEnxkDdsXpq+GEj2PaiE9&quot;</span><br><span class="line">      unset password &quot;要删除的账号的密码&quot;</span><br><span class="line">    next</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>经过测试这里 <code>unset password</code> 后，密码为空，即无需密码就能登录，这或许与一般安全产品的理念不同（没有钥匙则无法开锁）。</p>
</blockquote>
<ul>
<li>注意点：需要同时设置密码！</li>
</ul>
<h2 id="十、Juniper-JUNOS">十、Juniper JUNOS</h2>
<h3 id="1-官方文档">1. 官方文档</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Enable SSH service on the switch using the following command：</span></span></span><br><span class="line"><span class="meta prompt_">root@Juniper# </span><span class="language-bash"><span class="built_in">set</span> system services ssh</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Generate the SSH key on a device running Junos OS  by logging into the shell prompt as a root user：</span></span></span><br><span class="line"><span class="meta prompt_">root@Juniper&gt;</span><span class="language-bash">start shell</span></span><br><span class="line"><span class="meta prompt_">root@Juniper% </span><span class="language-bash">ssh-keygen -t rsa</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Once the keys are generated we can associate the key with the &quot;userid&quot; using the following command.</span></span></span><br><span class="line"><span class="meta prompt_">root@Juniper#</span><span class="language-bash"><span class="built_in">set</span> system login user &lt;userid&gt; uid 2000</span></span><br><span class="line"><span class="meta prompt_">root@Juniper#</span><span class="language-bash"><span class="built_in">set</span> system login user &lt;userid&gt; class super-user</span></span><br><span class="line"><span class="meta prompt_">root@Juniper#</span><span class="language-bash"><span class="built_in">set</span> system login user &lt;userid&gt; authentication load-key-file /root/.ssh/id_rsa.pub</span></span><br><span class="line"></span><br><span class="line">After running the above configuration commands, it will create a directory with &lt;userid&gt; in /var/home and the authorized_key for SSH will be created.</span><br><span class="line"></span><br><span class="line">When an upgrade/downgrade is performed, the files id_rsa and id_rsa.pub, which are locally created and are not part of configuration, will not be restored. Hence we will have to copy the contents of the /root/.ssh directory and put them back after the upgrade/downgrade is complete. We also will have to associate the user with the key using the following CLI command：</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">root@Juniper#</span><span class="language-bash"><span class="built_in">set</span> system login user &lt;userid&gt; authentication load-key-file /root/.ssh/id_rsa.pub</span></span><br></pre></td></tr></table></figure>
<h3 id="2-快速配置">2. 快速配置</h3>
<p>通常我们已经用 Linux 生成了自己的公钥和私钥，这里直接使用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 使用root账号登录，将公钥文件id_rsa.pub上传到/root/.ssh/下面（默认需要创建.ssh文件夹）</span></span></span><br><span class="line">start shell</span><br><span class="line">cd /root</span><br><span class="line">mkdir .ssh</span><br><span class="line">cd .ssh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Cluster环境，将id_rsa.pub上传到另外一个节点node1</span></span></span><br><span class="line">rcp -T /root/.ssh/id_rsa.pub node1：/root/.ssh/</span><br><span class="line">rlogin -T node1</span><br><span class="line">ls /root/.ssh/id_rsa.pub</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 新建账号，若账号已经创建并使用密码认证，将同时使用pub认证</span></span></span><br><span class="line">set system login user &lt;username&gt; class super-user authentication load-key-file /root/.ssh/id_rsa.pub</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 示例 使用key认证并取消密码认证</span></span></span><br><span class="line">set system login user sysin class super-user authentication load-key-file /root/.ssh/id_rsa.pub</span><br><span class="line">delete system login user sysin authentication encrypted-password #删除已有账号密码认证</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 示例 同时使用密码和key认证</span></span></span><br><span class="line">set system login user sysin class super-user authentication plain-text-password</span><br><span class="line">set system login user sysin class super-user authentication load-key-file /root/.ssh/id_rsa.pub</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 删除用户命令为：delete system login user &lt;username&gt;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 禁用root账号ssh登录</span></span></span><br><span class="line">set system services ssh root-login deny</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 恢复</span></span></span><br><span class="line">set system services ssh root-login allow</span><br></pre></td></tr></table></figure>
<h3 id="3-建议做法">3. 建议做法</h3>
<p>1). root 账号有密码，使用 root 账号上传 /root/.ssh/id_rsa.pub<br>
2). 新建一个 admin1 账号，注意不要使用敏感字符，使用 public key 认证，无密码<br>
3). 新建一个 admin2 账号，注意不要使用敏感字符，有复杂密码，或者同时使用 public key 认证，必要时候应急使用<br>
4). 禁用 root ssh login<br>
5). 必要时限制源地址访问，禁用密码认证</p>


        <hr>
          <!-- comment_tips start -->
          
            <!-- comment_tips end -->

        <div align="center">
          <a href="/donate/">捐助本站 ❤️ Donate</a>
        </div>

        <!-- promotion start -->
        
          <div align="center">
            <p>
              <a href="https://cloud.tencent.com/act/cps/redirect?redirect=2446&cps_key=78f957e545ecb2e5e2720d6ccf030209&from=console" target="_blank"><img src="/img/banner-qcloud.webp?v20230203" style="cursor:pointer;" alt="点击访问官方网站" /></a>
            </p>
          </div>
          <hr>
          
          <!-- promotion end -->

        <!-- Pager -->
        <ul class="pager">
          
          <li class="previous">
            <a href="/blog/veeam-one-10/" data-toggle="tooltip" data-placement="top" title="Veeam ONE 10 (Windows)">&larr; Previous Post</a>
          </li>
          
          
          <li class="next">
            <a href="/blog/varnish-with-hitch-http2/" data-toggle="tooltip" data-placement="top" title="Varnish with Hitch HTTP/2 implement on CentOS 8">Next Post &rarr;</a>
          </li>
          
        </ul>

        
        <!-- tip start -->
        <!-- tip -->
<!-- tip start -->
<div class="tip">
  <p>
    
      文章用于推荐和分享优秀的软件产品及其相关技术，所有软件默认提供官方原版（免费版或试用版），免费分享。对于部分产品笔者加入了自己的理解和分析，方便学习和研究使用。任何内容若侵犯了您的版权，请联系作者删除。如果您喜欢这篇文章或者觉得它对您有所帮助，或者发现有不当之处，欢迎您发表评论，也欢迎您分享这个网站，或者赞赏一下作者，谢谢！
    
  </p>
</div>
<!-- tip end -->

        <!-- tip end -->
        

        
          <!-- reward Srtart -->
          <!--赞赏-->

    <div class="reward">
        <div class="reward-button">赞 <span class="reward-code">
            <span class="alipay-code"> <img class="alipay-img" src="/img/alipay-s-68.webp"><b>支付宝赞赏</b></span>
            <span class="wechat-code"> <img class="wechat-img" src="/img/wechatpay-s-68.webp"><b>微信赞赏</b> </span>
            </span></div>
        <p class="reward-notice">赞赏一下</p>
    </div>

<!--赞赏end-->
          <!-- reward End -->
        

        
        <!-- Sharing Srtart -->
        <!-- Social Social Share Post -->
<!-- sites: ['weibo', 'qq', 'wechat', 'douban', 'qzone', 'linkedin', 'facebook', 'twitter', 'google'] -->
<!-- Docs:https://github.com/overtrue/share.js -->
<div class="social-share" data-disabled="douban" data-wechat-qrcode-helper="" data-mobile-sites="weibo,wechat,qq,qzone,linkedin" align="center">
</div>

<!-- css & js -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"> -->
<!-- <script defer="defer" async="true" src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script> -->
<link rel="stylesheet" href="/css/share.min.css">
<script defer="defer" async="true" src="/js/social-share.min.js"></script>

        <!-- Sharing End -->
        <hr>
        

        <!-- comments start -->
        <!-- 默认 comments: true -->
        <!-- 关闭 comments: false -->
        
        <!-- 0. waline comment (by sysin.org)-->

  <!-- waline Srtart -->
  <div style="color:gray" align="center">
    <span>☑️ 评论恢复，欢迎留言❗️</br>敬请注册！点击 “登录” - “<font color="blue">用户注册</font>”（已知不支持 21.cn/189.cn 邮箱）。<font color="red">请勿使用联合登录（已关闭）</font>。</span>
  </div>
  <div id="waline" style="all: unset; /* max-width: 100%; margin: 0 auto; */"></div>
  <style>
    :root {
      /* 字体大小 */
      --waline-font-size: 1.75rem;
      /* 头像大小 */
      --waline-avatar-size: 5.25rem;
      /* 评论状态按钮高亮色 */
      --waline-disable-bgcolor: #abe2fc;
    }
    .wl-login-nick {
      /* 昵称字体大小 */
      font-size:.05em;
    }
    /* 你需要把 `https://img.t.sinajs.cn` 换成自己的 CDN */
    .wl-content img[src^="https://unpkg.com/@waline/"] {
      width: 1.25em;
      margin: 0.25em;
      vertical-align: middle;
    }
  </style>
  <script type="text/javascript">
      Waline.init({
        el: '#waline',
        serverURL: 'https://discuss.sysin.cn',
        login: 'force',
        wordLimit: [3, 300],
        pageSize: 10,
        imageUploader: false,
        search: false,
        reaction: false,
        copyright: false,
        // pageview: true,
        // path: '/blog/public-key-authentication/',
        emoji: false,
        locale: {
          admin: '作者',
          placeholder: '欢迎留言！请使用邮箱注册，注册仅需提供有效邮件地址，无需其他个人信息，谢谢。',
          level0: '777',
          level1: '755',
          level2: '644',
          level3: '600',
          level4: '400',
          level5: '000',
        },
      });
  </script>
  <!-- <div style="color:gray" align="right">
    Pageviews: <span class="waline-pageview-count" /"></span>
  </div> -->
  <!-- waline End -->
  

    <!-- 0. valine comment (by sysin.org)-->
    

        <!-- 1. gitalk comment -->
        

                  <!-- 2. gitment comment -->
                  

                      <!-- 3. disqus comment -->
                      
        <hr>
        
        <!-- comments end -->

      </div>

      <!-- Catalog: Tabe of Content -->
      <!-- Table of Contents -->

  <!-- Don not display number -->
  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
  <!-- Don not display number -->
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">目录</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%B8%80%E3%80%81Public-Key-%E8%AE%A4%E8%AF%81%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">一、Public Key 认证基本原理</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%BA%8C%E3%80%81Public-Key-%E8%AE%A4%E8%AF%81%E7%9B%B8%E5%AF%B9%E4%BA%8E-Password-%E8%AE%A4%E8%AF%81%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">二、Public Key 认证相对于 Password 认证的优点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%B8%89%E3%80%81Linux-Public-Key-%E9%85%8D%E7%BD%AE"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">三、Linux Public Key 配置</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%9B%9B%E3%80%81SSH-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BE%E7%BD%AE"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">四、SSH 客户端设置</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E4%BD%BF%E7%94%A8-Putty-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">1. 使用 Putty 客户端</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E4%BD%BF%E7%94%A8-SecureCRT-%E9%85%8D%E7%BD%AE%E5%85%AC%E9%92%A5"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">2. 使用 SecureCRT 配置公钥</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%BA%94%E3%80%81Cisco-IOS%E3%80%81IOS-XE"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">五、Cisco IOS、IOS-XE</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E5%90%AF%E7%94%A8-public-key-%E8%AE%A4%E8%AF%81"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">1. 启用 public key 认证</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%9C%A8-Linux-%E4%B8%8A%E7%94%9F%E6%88%90-key"><span class="toc-nav-number">5.1.1.</span> <span class="toc-nav-text">在 Linux 上生成 key</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%9C%A8-Linux-%E4%B8%BB%E6%9C%BA%E4%B8%8A%E6%9F%A5%E7%9C%8B-public-key"><span class="toc-nav-number">5.1.2.</span> <span class="toc-nav-text">在 Linux 主机上查看 public key</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E8%BD%AC%E6%8D%A2%E6%88%90%E5%A4%9A%E8%A1%8C%E6%A0%BC%E5%BC%8F"><span class="toc-nav-number">5.1.3.</span> <span class="toc-nav-text">转换成多行格式</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%9C%A8-Cisco-IOS-%E4%B8%8A%E9%85%8D%E7%BD%AE"><span class="toc-nav-number">5.1.4.</span> <span class="toc-nav-text">在 Cisco IOS 上配置</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E9%AA%8C%E8%AF%81-3"><span class="toc-nav-number">5.1.5.</span> <span class="toc-nav-text">验证</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">2. 其他配置</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Security-settings"><span class="toc-nav-number">5.2.1.</span> <span class="toc-nav-text">Security settings</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Multiple-keys"><span class="toc-nav-number">5.2.2.</span> <span class="toc-nav-text">Multiple keys</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E7%A7%BB%E9%99%A4%E5%AF%86%E7%A0%81"><span class="toc-nav-number">5.2.3.</span> <span class="toc-nav-text">移除密码</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Disable-passwords-entirely"><span class="toc-nav-number">5.2.4.</span> <span class="toc-nav-text">Disable passwords entirely</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%85%AD%E3%80%81Cisco-NX-OS"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">六、Cisco NX-OS</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E7%94%9F%E6%88%90%E5%85%AC%E9%92%A5%E6%96%87%E4%BB%B6id-rsa-pub%EF%BC%88%E5%8F%82%E7%9C%8BLinux%EF%BC%89"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">1. 生成公钥文件id_rsa.pub（参看Linux）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E5%AF%86%E9%92%A5"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">2. 配置用户使用密钥</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-1-%E4%BC%A0%E8%BE%93-id-rsa-pub-%E6%96%87%E4%BB%B6%E5%88%B0%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84-bootflash-%E4%B8%AD%E5%B9%B6%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7"><span class="toc-nav-number">6.2.1.</span> <span class="toc-nav-text">2.1. 传输 id_rsa.pub 文件到交换机的 bootflash 中并配置用户</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-2-%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%E5%AF%86%E9%92%A5%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="toc-nav-number">6.2.2.</span> <span class="toc-nav-text">2.2. 直接复制密钥进行配置</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-%E9%AA%8C%E8%AF%81%E9%85%8D%E7%BD%AE"><span class="toc-nav-number">6.3.</span> <span class="toc-nav-text">3. 验证配置</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-%E9%AA%8C%E8%AF%81-2"><span class="toc-nav-number">6.4.</span> <span class="toc-nav-text">4. 验证</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%B8%83%E3%80%81F5-BIG-IP"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">七、F5 BIG-IP</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E6%A0%87%E5%87%86%E5%81%9A%E6%B3%95"><span class="toc-nav-number">7.1.</span> <span class="toc-nav-text">1. 标准做法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E5%BB%BA%E8%AE%AE%E5%81%9A%E6%B3%95"><span class="toc-nav-number">7.2.</span> <span class="toc-nav-text">2. 建议做法</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%85%AB%E3%80%81Palo-Alto-PAN-OS"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">八、Palo Alto PAN-OS</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E7%94%9F%E6%88%90-ssh-key%EF%BC%8C%E5%8F%82%E7%85%A7-Linux"><span class="toc-nav-number">8.1.</span> <span class="toc-nav-text">1. 生成 ssh key，参照 Linux</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E9%85%8D%E7%BD%AE-Public-Key-%E8%AE%A4%E8%AF%81"><span class="toc-nav-number">8.2.</span> <span class="toc-nav-text">2. 配置 Public Key 认证</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-1-%E4%BD%BF%E7%94%A8-GUI-%E7%95%8C%E9%9D%A2"><span class="toc-nav-number">8.2.1.</span> <span class="toc-nav-text">2.1 使用 GUI 界面</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-2-%E4%BD%BF%E7%94%A8-CLI"><span class="toc-nav-number">8.2.2.</span> <span class="toc-nav-text">2.2 使用 CLI</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%B9%9D%E3%80%81Fortinet-FortiOS"><span class="toc-nav-number">9.</span> <span class="toc-nav-text">九、Fortinet FortiOS</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%8D%81%E3%80%81Juniper-JUNOS"><span class="toc-nav-number">10.</span> <span class="toc-nav-text">十、Juniper JUNOS</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-nav-number">10.1.</span> <span class="toc-nav-text">1. 官方文档</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE"><span class="toc-nav-number">10.2.</span> <span class="toc-nav-text">2. 快速配置</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-%E5%BB%BA%E8%AE%AE%E5%81%9A%E6%B3%95"><span class="toc-nav-number">10.3.</span> <span class="toc-nav-text">3. 建议做法</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    



      <!-- Post Domain Container -->
      <div class="col-lg-10 col-lg-offset-0 col-md-10 col-md-offset-1 sidebar-container">

        <!-- Featured Tags -->
        
        <section>
          <!-- no hr -->
          <h5>
            <a href="/tags/">特色标签</a>
          </h5>
          <div class="tags">
            
            <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
            
            <a class="tag" href="/tags/#Cisco" title="Cisco">Cisco</a>
            
            <a class="tag" href="/tags/#NX-OS" title="NX-OS">NX-OS</a>
            
            <a class="tag" href="/tags/#F5" title="F5">F5</a>
            
            <a class="tag" href="/tags/#FortiOS" title="FortiOS">FortiOS</a>
            
            <a class="tag" href="/tags/#PAN-OS" title="PAN-OS">PAN-OS</a>
            
          </div>
        </section>
        

        <!-- Friends Blog -->
        
        <hr>
        <h5>网站链接</h5>
        <ul class="list-inline">

          
          <li>
            <a href="https://curl.qcloud.com/IQz7k8Kc" target="_blank">腾讯云限时秒杀</a>
          </li>
          
          <li>
            <a href="https://www.aliyun.com/minisite/goods?userCode=ne0pli3k" target="_blank">阿里云优惠活动</a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</article>



<!-- anchorjs start -->
<!-- async load function -->
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script type="text/javascript">
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function(e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  };
</script>
<script type="text/javascript">
  //anchor-js, Doc:http://bryanbraun.github.io/anchorjs/
  async ("/js/anchor.min.js", function() {
    anchors.options = {
      visible: 'hover',
      placement: 'left',
      // icon: 'ℬ'
      icon: '❡'
    };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
  });
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

<!-- anchorjs end -->



		<!-- Footer (contains ThemeColor、viewer) -->
		<!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-11 col-lg-offset-0 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          
            <li>
              <a href="/feed.xml">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          

          

          

          

          

          

          
            <li>
              <a target="_blank" href="https://www.cnblogs.com/sysin">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse">博</i>
                </span>
              </a>
            </li>
          

          
            <li>
              <a target="_blank" href="https://www.zhihu.com/people/sysinside">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse">知</i>
                </span>
              </a>
            </li>
          

          

        </ul>
        <p class="copyright text-muted">
          Copyright &copy; sysin 2025
          <br>
          Build with <a href="https://hexo.io/" target=_blank>Hexo</a>
          <span style="display: inline-block; margin: 0 5px;">
              <i class="fa fa-heart"></i>
          </span>
          Powered by <a href="https://github.com/" target=_blank><img border="0" src="/img/github.png"></a>
          <br>
          
      </p>
      </div>
    </div>
  </div>
</footer>

<a id="rocket" href="#top" class=""></a>


  <!-- jQuery -->
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <!-- Custom Theme JavaScript -->
  <script type="text/javascript" src="/js/hux-blog.min.js"></script>
  <!-- catalog -->
  <script async="true" type="text/javascript" src="/js/catalog.js"></script>
  <!-- totop(rocket) -->
  <script async="true" type="text/javascript" src="/js/totop.js"></script>

  

  
    <!-- Scroll start -->
    <script async="async" type="text/javascript" src="/js/scroll.js"></script>
    <!-- Scroll end -->
  

  

  

  
    <!-- ribbon -->
    <script type="text/javascript" src="/js/ribbonDynamic.js"></script>
  

  







<script>
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }

  // fastClick.js
  //GC change fastclick.min.js to local and rename to fc.min.js, because AdBlock Plus
  //https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js
  //https://cdn.staticfile.org/fastclick/1.0.6/fastclick.min.js
  async ("/js/fc.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav)
      FastClick.attach($nav);
    }
  )
</script>

<!-- Because of the native support for backtick-style fenced code blocks right within the Markdown is landed in Github Pages, From V1.6, There is no need for Highlight.js, so Huxblog drops it officially. -
https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0 - https://help.github.com/articles/creating-and-highlighting-code-blocks/ -->
<!-- <script> async ("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function () { hljs.initHighlightingOnLoad(); }) </script> <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet"> -->

<!-- jquery.tagcloud.js -->
<!-- <script> // only load tagcloud.js in tag.html if ($('#tag_cloud').length !== 0) { async ("https://sysin.cn/js/jquery.tagcloud.js", function () { $.fn.tagcloud.defaults = { // size: { start: 1, end: 1, unit: 'em' }, color: {
start: '#bbbbee', end: '#0085a1' } }; $('#tag_cloud a').tagcloud(); }) } </script> -->


		<!-- Search -->
		
		<div class="popup search-popup local-search-popup">
  <span class="popup-btn-close">
    ESC
  </span>
  <div class="container">
    <div class="row">
      <div class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1 local-search-content">

        <div class="local-search-header clearfix">

          <div class="local-search-input-wrapper">
            <span class="search-icon">
              <i class="fa fa-search fa-lg" style="margin: 25px 10px 25px 20px;"></i>
            </span>
            <input autocomplete="off" placeholder="搜索..." type="text" id="local-search-input">
          </div>
        </div>
        <div id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


  
    <script src="/js/ziploader.js"></script>
  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // get search zip version
    $.get('/searchVersion.json?t=' + (+new Date()), function (res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson() {
      initLoad(['/search.fle'], {
        loadOptions: {
          success: function (obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function (e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions: {
          'json': 'application/json'
        }
      })
    }
    // search function;
    var searchFunc = function (search_id, content_id) {
      'use strict';
      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      // console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function () {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function (data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title
              ? data.title.trim()
              : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content
              ? data.content.trim().replace(/<[^>]+>/g, "")
              : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);

            var date = data.date;
            var dateTime = date.replace(/T/, " ").replace(/.000Z/, "");
            var imgUrl = data.header_img;
            


            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function (keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0,
                  position = [],
                  index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }
              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }
            // show search results
            if (isMatch) {
              // sort index by position of keyword
              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });
              // merge hits into slices
              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;
                  // move to next position of hit
                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice};
              }
              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }
              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if (start < 0) {
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if (end > content.length) {
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }
              // sort slices in content by search text's count and hits' count
              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });
              // select top N slices in content
              var upperBound = parseInt('1');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }
              // highlight title and content
              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }
              var resultItem = '';

              // if (slicesOfTitle.length != 0) {   resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>"; } else {   resultItem += "<li><a target='_blank' href='" +
              // articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) {   resultItem += "<a target='_blank' href='" + articleUrl + "'><p class=\"search-result\">" + highlightKeyword(content, slice) +
              // "...</p></a>"; }); resultItem += "</li>";

              if (slicesOfTitle.length != 0) {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</div><time class='search-result-date'>" + dateTime + "</time>";
              } else {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + title + "</div><time class='search-result-date'>" + dateTime + "</time>";
              }
              slicesOfContent.forEach(function (slice) {
                resultItem += "<p class=\"search-result-content\">" + highlightKeyword(content, slice) + "...</p>";
              });
              resultItem += "</div><div class='search-result-right'><img class='media-image' src='" + imgUrl + "' width='64px' height='48px'></img></div></a>";

              resultItems.push({item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length});
            }
          })
        };

        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<div class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</div>";
          resultContent.innerHTML = searchResultList;
        }
      }
      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }
      // remove loading animation
      $('body').css('overflow', '');
      proceedsearch();
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function (e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function (e) {
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    document.addEventListener('mouseup', (e) => {
      var _con = document.querySelector(".local-search-content");
      if (_con) {
        if (!_con.contains(e.target)) {
          onPopupClose();
        }
      }
    });
  </script>


		
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
